<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Telugu â†’ English Translator</title>

<style>
body{font-family:Arial;background:#eef2f7;padding:30px}
.container{
  max-width:950px;
  margin:auto;
  background:#fff;
  padding:25px;
  border-radius:12px;
}
button{
  padding:10px 16px;
  margin:6px;
  font-size:14px;
  cursor:pointer
}
textarea{
  width:100%;
  height:120px;
  margin-top:10px;
  font-size:15px;
  padding:10px
}
.status{font-weight:bold;margin:10px 0}
.green{color:green}
.red{color:red}
.section{margin-top:20px}
</style>
</head>

<body>

<div class="container">
<h2>Telugu Speech â†’ English Text</h2>

<button onclick="startSpeech()">Start</button>
<button onclick="stopSpeech()">Stop</button>
<button onclick="clearAll()">Clear</button>

<div class="status" id="status">
Status: <span class="red">Stopped</span>
</div>

<div class="section">
<h3>Telugu Text</h3>
<button onclick="copyText('teluguText')">ðŸ“‹ Copy Telugu</button>
<textarea id="teluguText"></textarea>
</div>

<div class="section">
<h3>English Translation</h3>
<button onclick="copyText('englishText')">ðŸ“‹ Copy English</button>
<button onclick="speakEnglish()">ðŸ”Š Speak English</button>
<textarea id="englishText"></textarea>
</div>

</div>

<script>
let recognition;
let finalText = "";
let translateTimer = null;

/* ---------- START SPEECH ---------- */
function startSpeech(){
  const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
  if(!SR){
    alert("Please use Chrome or Edge browser");
    return;
  }

  finalText = "";
  recognition = new SR();
  recognition.lang = "te-IN";
  recognition.continuous = true;
  recognition.interimResults = true;

  recognition.onresult = e => {
    let interim = "";
    for(let i=e.resultIndex;i<e.results.length;i++){
      if(e.results[i].isFinal){
        finalText += e.results[i][0].transcript + " ";
      } else {
        interim += e.results[i][0].transcript;
      }
    }
    const fullText = finalText + interim;
    document.getElementById("teluguText").value = fullText;
    debounceTranslate(fullText);
  };

  recognition.onstart = ()=>{
    document.getElementById("status").innerHTML =
      'Status: <span class="green">Listening...</span>';
  };

  recognition.onend = ()=>{
    document.getElementById("status").innerHTML =
      'Status: <span class="red">Stopped</span>';
  };

  recognition.start();
}

/* ---------- STOP ---------- */
function stopSpeech(){
  if(recognition) recognition.stop();
}

/* ---------- DEBOUNCE ---------- */
function debounceTranslate(text){
  if(translateTimer) clearTimeout(translateTimer);
  translateTimer = setTimeout(()=>translate(text),600);
}

/* ---------- TRANSLATE ---------- */
function translate(text){
  if(!text.trim()) return;

  fetch("https://libretranslate.de/translate",{
    method:"POST",
    headers:{
      "Content-Type":"application/json",
      "Accept":"application/json"
    },
    body:JSON.stringify({
      q:text,
      source:"te",
      target:"en"
    })
  })
  .then(r=>r.json())
  .then(d=>{
    if(d.translatedText){
      document.getElementById("englishText").value = d.translatedText;
    } else fallback(text);
  })
  .catch(()=>fallback(text));
}

/* ---------- FALLBACK ---------- */
function fallback(text){
  fetch("https://api.mymemory.translated.net/get?q="
    + encodeURIComponent(text) + "&langpair=te|en")
  .then(r=>r.json())
  .then(d=>{
    document.getElementById("englishText").value =
      d.responseData.translatedText;
  });
}

/* ---------- COPY ---------- */
function copyText(id){
  const el = document.getElementById(id);
  el.select();
  el.setSelectionRange(0, 99999);
  document.execCommand("copy");
  alert("Copied!");
}

/* ---------- SPEAK ---------- */
function speakEnglish(){
  const text = document.getElementById("englishText").value;
  if(!text.trim()) return;

  const utterance = new SpeechSynthesisUtterance(text);
  utterance.lang = "en-US";
  speechSynthesis.speak(utterance);
}

/* ---------- CLEAR ---------- */
function clearAll(){
  finalText="";
  document.getElementById("teluguText").value="";
  document.getElementById("englishText").value="";
}
</script>

</body>
</html>

