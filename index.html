<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Telugu Speech to English</title>

<style>
body{font-family:Arial;background:#f4f6f9;padding:30px}
.container{
  max-width:900px;
  margin:auto;
  background:#fff;
  padding:25px;
  border-radius:10px;
}
button{padding:10px 18px;margin:5px;font-size:14px}
textarea{width:100%;height:120px;margin-top:10px;font-size:15px}
.status{font-weight:bold;margin-top:10px}
.green{color:green}
.red{color:red}
</style>
</head>

<body>

<div class="container">
<h2>ðŸŽ¤ Telugu Speech â†’ English (Automatic)</h2>

<button onclick="startSpeech()">Start</button>
<button onclick="stopSpeech()">Stop</button>
<button onclick="clearAll()">Clear</button>

<div class="status" id="status">Status: <span class="red">Stopped</span></div>

<h3>Telugu Text</h3>
<button onclick="copyText('teluguText')">Copy Telugu</button>
<textarea id="teluguText"></textarea>

<h3>English Text</h3>
<button onclick="copyText('englishText')">Copy English</button>
<textarea id="englishText"></textarea>
</div>

<script>
let recognition;
let fullText = "";

/* -------- START SPEECH -------- */
function startSpeech(){
  const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
  if(!SR){
    alert("Use Chrome or Edge browser");
    return;
  }

  recognition = new SR();
  recognition.lang = "te-IN";
  recognition.continuous = true;
  recognition.interimResults = false;

  recognition.onresult = e => {
    fullText += e.results[e.results.length-1][0].transcript + " ";
    document.getElementById("teluguText").value = fullText;
  };

  recognition.onstart = () => {
    document.getElementById("status").innerHTML =
      'Status: <span class="green">Listening...</span>';
  };

  recognition.onend = () => {
    document.getElementById("status").innerHTML =
      'Status: <span class="red">Stopped</span>';
  };

  recognition.start();
}

/* -------- STOP & AUTO TRANSLATE -------- */
function stopSpeech(){
  if(recognition) recognition.stop();

  if(fullText.trim()){
    autoTranslate(fullText);
  }
}

/* -------- AUTO TRANSLATION -------- */
function autoTranslate(text){
  document.getElementById("englishText").value = "Translating...";

  fetch("https://libretranslate.de/translate",{
    method:"POST",
    headers:{
      "Content-Type":"application/json",
      "Accept":"application/json"
    },
    body:JSON.stringify({
      q:text,
      source:"te",
      target:"en",
      format:"text"
    })
  })
  .then(r=>r.json())
  .then(d=>{
    if(d.translatedText){
      document.getElementById("englishText").value = d.translatedText;
    } else {
      fallback(text);
    }
  })
  .catch(()=>fallback(text));
}

/* -------- FALLBACK -------- */
function fallback(text){
  fetch("https://api.mymemory.translated.net/get?q="
    + encodeURIComponent(text) + "&langpair=te|en")
  .then(r=>r.json())
  .then(d=>{
    document.getElementById("englishText").value =
      d.responseData.translatedText;
  })
  .catch(()=>{
    document.getElementById("englishText").value =
      "Translation failed. Try again later.";
  });
}

/* -------- UTILITIES -------- */
function copyText(id){
  const el = document.getElementById(id);
  el.select();
  document.execCommand("copy");
  alert("Copied!");
}

function clearAll(){
  fullText="";
  document.getElementById("teluguText").value="";
  document.getElementById("englishText").value="";
}
</script>

</body>
</html>
